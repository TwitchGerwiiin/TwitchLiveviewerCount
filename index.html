<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <title>Twitchliveviewercount by Rookev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
</head>
<body>
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script type="text/javascript">
    var QueryString = function () {
  // This function is anonymous, is executed immediately and 
  // the return value is assigned to QueryString!
  var query_string = {};
  var query = window.location.href;
  var vars = query.split("#")[1];
  vars = vars.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
        // If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = decodeURIComponent(pair[1]);
        // If second entry with this name
      } else if (typeof query_string[pair[0]] === "string") {
        var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
        query_string[pair[0]] = arr;
        // If third or later entry with this name
      } else {
        query_string[pair[0]].push(decodeURIComponent(pair[1]));
      }
    } 
    return query_string;
  }();

  var username = QueryString.username;
  var refreshInSeconds = 5000;

  if (QueryString.refreshInSeconds !== undefined) {
    var refreshInSeconds = QueryString.refreshInSeconds * 1000;
  }


  $(document).ready(function() {
    loadViewers();
    function loadViewers(){
      $.getJSON('https://api.twitch.tv/kraken/streams/'+encodeURIComponent(username)+"?callback=?", function(data) {

        if(data["stream"]!=null){
          if(data['streams']){
            $('#viewer_counter').html("Channel offline.");
          }else{
            var viewer_count = data['stream']['viewers'];
            $('#viewer_counter').html(viewer_count);
            console.log(data);
          }
        }else{
          $('#viewer_counter').html("Channel offline.");
        }
      });
    }
    setInterval(function(){
      loadViewers();
    }, QueryString.refreshInSeconds);
  });
</script>
<div id="viewer_counter">Loading...</div>
</body>
</html>
